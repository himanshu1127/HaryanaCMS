<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="addorviewofficers.css" />
    <title>Add/View SP</title>
    <link rel="stylesheet" href="./Dashboard.css" />
    <link rel="stylesheet" href="buttonActions.css" />
    <link rel="stylesheet" href="./form.css" />
    <link rel="stylesheet" href="./updateOfficer.css" />

    <script
      src="https://kit.fontawesome.com/ffe2b9fea9.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body style="height: fit-content">
    <nav id="navbar"></nav>
    <div id="main">
      <div class="sidebar"></div>
      <div id="right-container">
        <h3 style="text-transform: uppercase; margin-top: 20px">
          Add of Superintendent Police of Police
        </h3>
        <div id="officerinfoinput">
          <form id="addSP" onsubmit="addSP(event)">
            <div id="whole-form">
              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="name"
                      >Name of SP : <span class="required">*</span></label
                    >
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      id="fname"
                      name="name"
                      placeholder="First Name"
                      required
                    />
                    <input
                      type="text"
                      id="lname"
                      placeholder="Last Name"
                      required
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="range"
                      >Range : <span class="required">*</span></label
                    >
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="rangesSP" required>
                      <!-- <option value="select">Select Range</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="username"
                      >Username : <span class="required">*</span></label
                    >
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="designation"
                      id="username"
                      placeholder="Username"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="mobile"
                      >Mobile No. : <span class="required">*</span></label
                    >
                  </div>
                  <div class="inputDiv">
                    <input
                      type="tel"
                      minlength="10"
                      maxlength="10"
                      name="mobile"
                      id="mobile"
                      placeholder="Mobile No"
                      pattern="[0-9]*"
                      title="Please enter a valid mobile number (numeric values only)"
                      required
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="district"
                      >District : <span class="required">*</span></label
                    >
                  </div>
                  <div class="inputDiv">
                    <select name="districts" id="districtSP">
                      <!-- <option value="select">Select District</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="password"
                      >Password : <span class="required">*</span></label
                    >
                  </div>
                  <div class="inputDiv">
                    <input
                      type="password"
                      name="password"
                      id="password"
                      placeholder="Password"
                      required
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>
            </div>
            <div style="margin-top: 20px; text-align: center">
              <!-- <button onclick="addSP()" id="addinfo">Add</button> -->
              <input id="addinfo" type="submit" value="Add SP" />
            </div>
          </form>
        </div>

        <div
          style="
            /* border: 1px solid cyan; */
            width: 100%;
            margin: auto;
            /* height: 90vh;
        overflow-y: auto; */
            margin-top: 20px;
          "
        >
          <div id="officerlist">
            <table
              border="1"
              style="
                text-align: center;
                border-collapse: collapse;
                border-radius: 3%;
              "
            >
              <thead>
                <tr
                  style="
                    text-align: center;
                    height: 40px;
                    border: 1px solid green;
                  "
                >
                  <th style="width: 7%">S No.</th>
                  <th>Posting</th>
                  <th>Name (S/Shri)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="updateOfficer">
      <div>
        <div class="updateHeader">
          <h3 class="h3AddComp">Update SP</h3>
          <div class="closeIconUpdate">
            <div class="line1"></div>
            <div class="line2"></div>
          </div>
        </div>
        <div>
          <form action="">
            <div id="whole-form">
              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="name">Name of SP :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      id="updateFname"
                      name="name"
                      placeholder="First Name"
                    />
                    <input
                      type="text"
                      id="updateLname"
                      placeholder="Last Name"
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="range">Range :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="UpdateRangesSP">
                      <option value="select">Select Range</option>
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="username">Username :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="designation"
                      id="updateUsername"
                      placeholder="Username"
                    />
                  </div>
                </div>
              </div>

              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="mobile">Mobile No. :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="mobile"
                      id="updateMobile"
                      placeholder="Mobile No"
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="district">District :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="districts" id="updateDistrictSP">
                      <option value="select">Select District</option>
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="password">Password :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="password"
                      name="password"
                      id="updatePassword"
                      placeholder="Password"
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>
            </div>
          </form>
          <div class="buttonDiv">
            <button
              onclick="updateComplain()"
              type="submit"
              class="updateButton my-5 p-3 border-2 border-green-400 hover:border-green-600 hover:bg-green-600 transition-all rounded font-bold hover:text-white"
            >
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="viewOfficer">
      <div>
        <div class="viewHeader">
          <h3 class="h3AddComp">View SP</h3>
          <div class="closeIconview">
            <div class="line1"></div>
            <div class="line2"></div>
          </div>
        </div>
        <div>
          <form id="View-Officer">
            <div id="whole-form">
              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="name">Name of SP :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      id="viewFname"
                      name="name"
                      placeholder="First Name"
                      disabled
                    />
                    <input
                      type="text"
                      id="viewLname"
                      placeholder="Last Name"
                      disabled
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="range">Range :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="viewRangesSP" disabled>
                      <option value="select">Select Range</option>
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="username">Username :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="designation"
                      id="viewUsername"
                      placeholder="Username"
                      disabled
                    />
                  </div>
                </div>
              </div>

              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="mobile">Mobile No. :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="mobile"
                      id="viewMobile"
                      placeholder="Mobile No"
                      disabled
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="district">District :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="districts" id="viewDistrictSP" disabled>
                      <option value="select">Select District</option>
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="password">Password :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="password"
                      name="password"
                      id="viewPassword"
                      placeholder="Password"
                      disabled
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- <div class="buttonDiv">
            <button
              onclick="viewComplain()"
              type="submit"
              class="viewButton my-5 p-3 border-2 border-green-400 hover:border-green-600 hover:bg-green-600 transition-all rounded font-bold hover:text-white"
            >
              View
            </button>
          </div> -->
        </div>
      </div>
    </div>
  </body>
  <script src="./function.js"></script>
</html>
<!-- <script src="./getRange.js"></script> -->
<script>
  const getRangeSP = async () => {
    let res = await fetch(`https://hrycms.onrender.com/range/getRange`);
    res = await res.json();
    // console.log(res);
    appendRangeSP(res);
    appendviewRangesSP(res);
  };
  const getDistrictSP = async () => {
    let res = await fetch(`https://hrycms.onrender.com/district/getDistrict`);
    res = await res.json();
    // console.log(res);
    appendDistrictSP(res);
    appendviewDistrictSP(res);
  };
  const getStationSP = async () => {
    let res = await fetch(
      `https://hrycms.onrender.com/policestation/getPolicestation`
    );
    res = await res.json();
    // console.log(res);
    appendStationSP(res);
  };

  const appendRangeSP = (data) => {
    let rangesSP = document.getElementById("rangesSP");
    // let UpdateRangesSP = document.getElementById("UpdateRangesSP")
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeName;
      option.value = el.rangeName;

      rangesSP.append(option);
      // UpdateRangesSP.append(option)
    });
  };
  const appendDistrictSP = (data) => {
    let districtSP = document.getElementById("districtSP");
    // let updateDistrictSP = document.getElementById("updateDistrictSP")
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeDistrictName;
      option.value = el.rangeDistrictName;

      districtSP.append(option);
      // updateDistrictSP.append(option)
    });
  };
  const appendStationSP = (data) => {
    let policeStationSP = document.getElementById("policeStationSP");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.policeStationName;
      option.value = el.policeStationName;

      policeStationSP.append(option);
    });
  };

  getRangeSP();
  getDistrictSP();

  // Update

  const getRangeSPUpdate = async () => {
    let res = await fetch(`https://hrycms.onrender.com/range/getRange`);
    res = await res.json();
    // console.log(res);
    appendRangeSPUpdate(res);
  };
  const getDistrictSPUpdate = async () => {
    let res = await fetch(`https://hrycms.onrender.com/district/getDistrict`);
    res = await res.json();
    // console.log(res);
    appendDistrictSPUpdate(res);
  };
  const getStationSPUpdate = async () => {
    let res = await fetch(
      `https://hrycms.onrender.com/policestation/getPolicestation`
    );
    res = await res.json();
    // console.log(res);
    appendStationSP(res);
  };

  const appendRangeSPUpdate = (data) => {
    // let rangesSP = document.getElementById("rangesSP")
    let UpdateRangesSP = document.getElementById("UpdateRangesSP");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeName;
      option.value = el.rangeName;

      // rangesSP.append(option)
      UpdateRangesSP.append(option);
    });
  };
  const appendDistrictSPUpdate = (data) => {
    // let districtSP = document.getElementById("districtSP")
    let updateDistrictSP = document.getElementById("updateDistrictSP");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeDistrictName;
      option.value = el.rangeDistrictName;

      // districtSP.append(option)
      updateDistrictSP.append(option);
    });
  };
  const appendStationSPUpdate = (data) => {
    // let policeStationSP = document.getElementById("policeStationSP")
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.policeStationName;
      option.value = el.policeStationName;

      // policeStationSP.append(option)
    });
  };

  getRangeSPUpdate();
  getDistrictSPUpdate();
  // getStationSP()

  // View

  const appendviewRangesSP = (data) => {
    // let rangesSP = document.getElementById("rangesSP")
    let viewRangesSP = document.getElementById("viewRangesSP");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeName;
      option.value = el.rangeName;

      // rangesSP.append(option)
      viewRangesSP.append(option);
    });
  };
  const appendviewDistrictSP = (data) => {
    let viewDistrictSP = document.getElementById("viewDistrictSP");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeDistrictName;
      option.value = el.rangeDistrictName;

      // districtSP.append(option)
      viewDistrictSP.append(option);
    });
  };
</script>
<script>
  const urlGet = `https://hrycms.onrender.com/user/allsp`;
  const urlAdd = `https://hrycms.onrender.com/user/signup`;
  const userId = JSON.parse(localStorage.getItem("userID"));
  let getData = async () => {
    try {
      let res = await fetch(urlGet);
      res = await res.json();
      // console.log(res);
      append(res);
    } catch (err) {
      // console.log(err);
    }
  };
  let get = (id) => {
    return document.getElementById(id);
  };
  let addSP = async () => {
    event.preventDefault();
    // console.log("clicked")
    let obj = {
      fname: get("fname").value,
      lname: get("lname").value,
      mobile: get("mobile").value,
      alternatemobile: "",
      policerange: get("rangesSP").value,
      districtofc: get("districtSP").value,
      spname: "",
      designation: "SP",
      policestation: "",
      email: get("username").value,
      password: get("password").value,
    };
    obj = JSON.stringify(obj);
    // console.log(obj);
    try {
      let res = await fetch(urlAdd, {
        method: "POST",
        body: obj,
        headers: {
          "Content-type": "application/json",
        },
      });
      res = await res.json();
      alert("SP Added")

      getData();
      console.log(res);
      get("fname").value = "";
      get("lname").value = "";
      get("mobile").value = "";
      // get("alternateNo").value = "";
      // get("policeRange").value = "";
      // get("rangesSP").value = "select";
      // get("districtSP").value = "select";
      get("username").value = "";
      get("password").value = "";
    } catch (err) {}
  };

  // Append Data
  let container = document.getElementById("tbody");
  let i = 0;
  const append = (data) => {
    container.innerHTML = null;
    data.map((el) => {
      i++;

      let tr = document.createElement("tr");
      tr.style.height = "40px";
      tr.style.border = "1px solid green";
      let td1 = document.createElement("td");
      td1.innerText = i;
      td1.style.borderRadius = "3%";
      let td2 = document.createElement("td");
      td2.innerText = `${el.designation} ${el.districtofc}`;
      let td3 = document.createElement("td");
      td3.innerText = `${el.fname} ${el.lname}`;
      let td8 = document.createElement("td");
      let divtd8 = document.createElement("div");
      divtd8.style.display = "inline";
      // divtd8.style.gap="5px"
      let updateIcon = document.createElement("button");
      updateIcon.addEventListener("click", () => {
        updateDataForm(el);
      });

      let viewIcon = document.createElement("button");
      let deleteIcon = document.createElement("button");
      updateIcon.setAttribute("class", "buttonsAction");
      updateIcon.setAttribute("id", "updateButton");
      viewIcon.setAttribute("class", "buttonsAction");
      viewIcon.addEventListener("click", () => {
        viewOfficer(el);
      });
      deleteIcon.setAttribute("class", "buttonsAction");
      deleteIcon.addEventListener("click", () => {
        deleteSP(el);
      });
      updateIcon.innerHTML = '<i class="fa-solid fa-pen"></i>';
      updateIcon.style.width = "25%";

      viewIcon.innerHTML = '<i class="fa-solid fa-eye"></i>';
      viewIcon.style.margin = "5px";
      viewIcon.style.width = "25%";

      deleteIcon.innerHTML = `<i class="fa-solid fa-trash"></i>`;
      deleteIcon.style.width = "25%";
      // deleteIcon.style.margin="5px"

      // td8.innerText = "hi";
      // updateIcon.innerHTML('<i class="fa-light fa-pen"></i>')

      divtd8.append(updateIcon, viewIcon, deleteIcon);
      td8.append(divtd8);
      // if (i % 2 === 0) {
      //   tr.style.backgroundColor = "gray";
      // }
      tr.append(td1, td2, td3, divtd8);

      container.append(tr);
    });
    i = 0;
  };

  let a = {};
  const updateDataForm = (el) => {
    let updateOfficer = document.querySelector(".updateOfficer");
    updateOfficer.classList.toggle("activeUpdateOfficer");
    a = el;
    get("updateFname").value = el.fname;
    get("updateLname").value = el.lname;
    get("UpdateRangesSP").value = el.policerange;
    get("updateUsername").value = el.email;
    get("updateMobile").value = el.mobile;
    get("updateDistrictSP").value = el.districtofc;
    get("updatePassword").value = "";
    get("updatePassword").placeholder = "Write New Password";
    return a;
  };

  // Update Officer Details
  let updateComp = document.querySelector(".closeIconUpdate");
  updateComp.onclick = function () {
    let compUpdate = document.querySelector(".updateOfficer");
    compUpdate.classList.toggle("activeUpdateOfficer");
  };

  const updateComplain = async () => {
    let obj = {
      fname: get("updateFname").value,
      lname: get("updateLname").value,
      mobile: get("updateMobile").value,
      alternatemobile: "",
      policerange: get("UpdateRangesSP").value,
      districtofc: get("updateDistrictSP").value,
      spname: "",
      designation: "SP",
      policestation: "",
      email: get("updateUsername").value,
      password: get("updatePassword").value,
    };
    obj = JSON.stringify(obj);
    let res = await fetch(`https://hrycms.onrender.com/user/update/${a._id}`, {
      method: "PUT",
      body: obj,
      headers: {
        "Content-type": "application/json",
      },
    });
    res = await res.json();
    alert("Update");
    let compUpdate = document.querySelector(".updateOfficer");
    compUpdate.classList.toggle("activeUpdateOfficer");
    getData();
  };

  // View Officer
  const viewOfficer = (el) => {
    // console.log(el);
    let viewOfficer = document.querySelector(".viewOfficer");
    viewOfficer.classList.toggle("activeviewOfficer");
    a = el;
    get("viewFname").value = el.fname;
    get("viewLname").value = el.lname;
    get("viewRangesSP").value = el.policerange;
    get("viewUsername").value = el.email;
    get("viewMobile").value = el.mobile;
    get("viewDistrictSP").value = el.districtofc;
    get("viewPassword").value = "";
    get("viewPassword").placeholder = "Write New Password";
    return a;
  };
  let viewComp = document.querySelector(".closeIconview");
  viewComp.onclick = function () {
    let compview = document.querySelector(".viewOfficer");
    compview.classList.toggle("activeviewOfficer");
  };

  // Delete Officer
  const deleteSP = async (el) => {
    a = el;
    // console.log(a);
    let url = `https://hrycms.onrender.com/user/delete/${a._id}`;
    let res = await fetch(url, {
      method: "DELETE",
    });
    res = await res.json();
    // console.log(res);
    getData();
  };
  getData();
</script>
<script src="./common.js" type="module"></script>
