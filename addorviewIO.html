<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="addorviewofficers.css" />
    <title>Add/View IO</title>
    <link rel="stylesheet" href="./Dashboard.css" />
    <link rel="stylesheet" href="./buttonActions.css" />
    <link rel="stylesheet" href="./form.css" />
    <link rel="stylesheet" href="./updateOfficer.css" />
    <script
      src="https://kit.fontawesome.com/ffe2b9fea9.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body style="height: fit-content">
    <nav id="navbar"></nav>
    <div id="main">
      <div class="sidebar"></div>
      <div id="right-container">
        <h3 style="text-transform: uppercase; margin-top: 20px">
          Add Investigation Officer
        </h3>
        <div id="officerinfoinput">
          <form action="">
            <div id="whole-form">
              <div class="formSide">
                <!-- Name -->
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="name">Name of IO :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      id="fname"
                      name="name"
                      placeholder="First Name"
                    />
                    <input type="text" id="lname" placeholder="Last Name" />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="district">District :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="districtIO">
                      <option value="select">Select District</option>
                      <!-- <option value="HISAR">HISAR</option>
                      <option value="GURUGRAM">GURUGRAM</option>
                      <option value="PANIPAT">PANIPAT</option>
                      <option value="BHIWANI">BHIWANI</option>
                      <option value="SONIPAT">SONIPAT</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="range">Range :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="rangeIO">
                      <option value="select">Select Range</option>
                      <!-- <option value="KARNAL">KARNAL</option>
                      <option value="HISAR">HISAR</option>
                      <option value="AMBALA">AMBALA</option> -->
                      <!-- <option value="bhiwani">Bhiwani</option>
                      <option value="sonipat">Sonipat</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="username">Username :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="username"
                      id="username"
                      placeholder="Username"
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>

              <div class="formSide">
                <!-- Name -->
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="mobile">Mobile No. :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="mobile"
                      id="mobile"
                      placeholder="Mobile No"
                    />
                  </div>
                </div>

                <!-- <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="alternateNumber">Alternate Number :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="alternateNumber"
                      id="alternateNo"
                      placeholder="Alternate Number"
                    />
                  </div>
                </div> -->
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="policeRange">Police Station :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="policeStationIO">
                      <option value="select">Select Station</option>
                      <!-- <option value="KHARKHARA">KHARKHARA</option>
                      <option value="KANINA">KANINA</option>
                      <option value="PATAUDI">PATAUDI</option> -->
                      <!-- <option value="bhiwani">Bhiwani</option>
                      <option value="sonipat">Sonipat</option> -->
                    </select>
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="password">Password :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="password"
                      name="password"
                      id="password"
                      placeholder="Password"
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>
            </div>
          </form>
          <div style="margin-top: 20px; text-align: center">
            <button onclick="addIO()" id="addinfo">Add</button>
          </div>
        </div>

        <div
          style="
            /* border: 1px solid cyan; */
            width: 100%;
            margin: auto;
            /* height: 90vh;
        overflow-y: auto; */
            margin-top: 20px;
          "
        >
          <div id="officerlist">
            <table
              border="1"
              style="
                text-align: center;
                border-collapse: collapse;
                border-radius: 3%;
              "
            >
              <thead>
                <tr
                  style="
                    text-align: center;
                    height: 40px;
                    border: 1px solid green;
                  "
                >
                  <th style="width: 7%">S No.</th>
                  <th>Posting</th>
                  <th>Name (S/Shri)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="updateOfficer">
      <div>
        <div class="updateHeader">
          <h3 class="h3AddComp">Update IO</h3>
          <div class="closeIconUpdate">
            <div class="line1"></div>
            <div class="line2"></div>
          </div>
        </div>
        <div>
          <form action="">
            <div id="whole-form">
              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="name">Name of IO :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      id="updateFname"
                      name="name"
                      placeholder="First Name"
                    />
                    <input
                      type="text"
                      id="updateLname"
                      placeholder="Last Name"
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="range">Range :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="UpdateRanges">
                      <!-- <option value="">Select Range</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="station">Police Station :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="station" id="UpdateStation">
                      <!-- <option value="">Select Station</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="username">Username :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="designation"
                      id="updateUsername"
                      placeholder="Username"
                    />
                  </div>
                </div>
              </div>

              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="mobile">Mobile No. :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="mobile"
                      id="updateMobile"
                      placeholder="Mobile No"
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="district">District :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="districts" id="updateDistrict">
                      <!-- <option value="">Select District</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="password">Password :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="password"
                      name="password"
                      id="updatePassword"
                      placeholder="Password"
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>
            </div>
          </form>
          <div class="buttonDiv">
            <button
              onclick="updateComplain()"
              type="submit"
              class="updateButton my-5 p-3 border-2 border-green-400 hover:border-green-600 hover:bg-green-600 transition-all rounded font-bold hover:text-white"
            >
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="viewOfficer">
      <div>
        <div class="viewHeader">
          <h3 class="h3AddComp">view IO</h3>
          <div class="closeIconview">
            <div class="line1"></div>
            <div class="line2"></div>
          </div>
        </div>
        <div>
          <form action="">
            <div id="whole-form">
              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="name">Name of IO :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      id="viewFname"
                      name="name"
                      placeholder="First Name"
                      disabled
                    />
                    <input
                      type="text"
                      id="viewLname"
                      placeholder="Last Name"
                      disabled
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="range">Range :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="range" id="viewRanges" disabled>
                      <!-- <option value="">Select Range</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="station">Police Station :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="station" id="viewStation" disabled>
                      <!-- <option value="">Select Station</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="username">Username :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="designation"
                      id="viewUsername"
                      placeholder="Username"
                      disabled
                    />
                  </div>
                </div>
              </div>

              <div class="formSide">
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="mobile">Mobile No. :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="text"
                      name="mobile"
                      id="viewMobile"
                      placeholder="Mobile No"
                      disabled
                    />
                  </div>
                </div>

                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="district">District :</label>
                  </div>
                  <div class="inputDiv">
                    <select name="districts" id="viewDistrict" disabled>
                      <!-- <option value="">Select District</option> -->
                    </select>
                  </div>
                </div>
                <div class="contentDivInputAndLabel">
                  <div class="labelDiv">
                    <label for="password">Password :</label>
                  </div>
                  <div class="inputDiv">
                    <input
                      type="password"
                      name="password"
                      id="viewPassword"
                      placeholder="Password"
                      disabled
                    />
                    <!-- <input type="text" placeholder="Last Name" /> -->
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- <div class="buttonDiv">
            <button
              onclick="viewComplain()"
              type="submit"
              class="viewButton my-5 p-3 border-2 border-green-400 hover:border-green-600 hover:bg-green-600 transition-all rounded font-bold hover:text-white"
            >
              view
            </button>
          </div> -->
        </div>
      </div>
    </div>
  </body>
  <script src="./function.js"></script>
</html>

<script>
  const getRangeIO = async () => {
    let res = await fetch(`https://hrycms.onrender.com/range/getRange`);
    res = await res.json();
    console.log(res);
    appendRangeIO(res);
    appendUpdateRanges(res);
    appendviewRanges(res);
  };
  const getDistrictIO = async () => {
    let res = await fetch(`https://hrycms.onrender.com/district/getDistrict`);
    res = await res.json();
    console.log(res);
    appendDistrictIO(res);
    appendupdateDistrict(res);
    appendviewDistrict(res);
  };
  const getStationIO = async () => {
    let res = await fetch(
      `https://hrycms.onrender.com/policestation/getPolicestation`
    );
    res = await res.json();
    console.log(res);
    appendStationIO(res);
    appendUpdateStation(res);
    appendviewStation(res);
  };

  const appendRangeIO = (data) => {
    let rangeIO = document.getElementById("rangeIO");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeName;
      option.value = el.rangeName;

      rangeIO.append(option);
    });
  };
  const appendDistrictIO = (data) => {
    let districtIO = document.getElementById("districtIO");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeDistrictName;
      option.value = el.rangeDistrictName;

      districtIO.append(option);
    });
  };
  const appendStationIO = (data) => {
    let policeStationIO = document.getElementById("policeStationIO");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.policeStationName;
      option.value = el.policeStationName;

      policeStationIO.append(option);
    });
  };

  getRangeIO();
  getDistrictIO();
  getStationIO();

  // Update

  const appendUpdateRanges = (data) => {
    let UpdateRanges = document.getElementById("UpdateRanges");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeName;
      option.value = el.rangeName;

      UpdateRanges.append(option);
    });
  };
  const appendupdateDistrict = (data) => {
    let updateDistrict = document.getElementById("updateDistrict");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeDistrictName;
      option.value = el.rangeDistrictName;

      updateDistrict.append(option);
    });
  };
  const appendUpdateStation = (data) => {
    let UpdateStation = document.getElementById("UpdateStation");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.policeStationName;
      option.value = el.policeStationName;

      UpdateStation.append(option);
    });
  };
  // View
  const appendviewRanges = (data) => {
    let viewRanges = document.getElementById("viewRanges");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeName;
      option.value = el.rangeName;

      viewRanges.append(option);
    });
  };
  const appendviewDistrict = (data) => {
    let viewDistrict = document.getElementById("viewDistrict");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.rangeDistrictName;
      option.value = el.rangeDistrictName;

      viewDistrict.append(option);
    });
  };
  const appendviewStation = (data) => {
    let viewStation = document.getElementById("viewStation");
    data.map((el) => {
      let option = document.createElement("option");
      option.innerText = el.policeStationName;
      option.value = el.policeStationName;

      viewStation.append(option);
    });
  };
</script>

<script>
  const urlGet = `https://hrycms.onrender.com/user/allio`;
  const urlAdd = `https://hrycms.onrender.com/user/signup`;
  let getData = async () => {
    try {
      let res = await fetch(urlGet);
      res = await res.json();
      console.log(res);
      append(res);
    } catch (err) {
      console.log(err);
    }
  };
  let get = (id) => {
    return document.getElementById(id);
  };
  let addIO = async () => {
    let obj = {
      fname: get("fname").value,
      lname: get("lname").value,
      mobile: get("mobile").value,
      alternatemobile: "",
      policerange: get("rangeIO").value,
      districtofc: get("districtIO").value,
      spname: "",
      designation: "IO",
      policestation: get("policeStationIO").value,
      email: get("username").value,
      password: get("password").value,
    };
    obj = JSON.stringify(obj);
    // console.log(obj);
    try {
      let res = await fetch(urlAdd, {
        method: "POST",
        body: obj,
        headers: {
          "Content-type": "application/json",
        },
      });
      res = await res.json();
      alert("IO Added")
      getData();
      console.log(res);
      get("fname").value = "";
      get("lname").value = "";
      get("mobile").value = "";
      // get("alternateNo").value = "";
      get("policeStationIO").value = "select";
      get("range").value = "select";
      get("districtIO").value = "select";
      get("username").value = "";
      get("password").value = "";
    } catch (err) {}
  };
  let container = document.getElementById("tbody");
  let i = 0;
  const append = (data) => {
    container.innerHTML = null;
    data.map((el) => {
      i++;

      let tr = document.createElement("tr");
      tr.style.height = "40px";
      tr.style.border = "1px solid green";
      let td1 = document.createElement("td");
      td1.innerText = i;
      td1.style.borderRadius = "3%";
      let td2 = document.createElement("td");
      td2.innerText = `${el.designation} ${el.policestation}`;
      let td3 = document.createElement("td");
      td3.innerText = `${el.fname} ${el.lname}`;

      let td8 = document.createElement("td");
      let divtd8 = document.createElement("div");
      divtd8.style.display = "inline";
      // divtd8.style.gap="5px"
      let updateIcon = document.createElement("button");

      let viewIcon = document.createElement("button");
      let deleteIcon = document.createElement("button");
      updateIcon.setAttribute("class", "buttonsAction");
      updateIcon.addEventListener("click", () => {
        updateDataForm(el);
      });
      viewIcon.setAttribute("class", "buttonsAction");
      viewIcon.addEventListener("click", () => {
        viewOfficer(el);
      });
      deleteIcon.setAttribute("class", "buttonsAction");
      updateIcon.innerHTML = '<i class="fa-solid fa-pen"></i>';
      updateIcon.style.width = "25%";

      viewIcon.innerHTML = '<i class="fa-solid fa-eye"></i>';
      viewIcon.style.margin = "5px";
      viewIcon.style.width = "25%";

      deleteIcon.innerHTML = `<i class="fa-solid fa-trash"></i>`;
      deleteIcon.style.width = "25%";
      deleteIcon.style.margin = "5px";
      deleteIcon.addEventListener("click", () => {
        deleteIO(el);
      });

      // td8.innerText = "hi";
      // updateIcon.innerHTML('<i class="fa-light fa-pen"></i>')

      divtd8.append(updateIcon, viewIcon, deleteIcon);
      td8.append(divtd8);
      // if (i % 2 === 0) {
      //   tr.style.backgroundColor = "gray";
      // }
      tr.append(td1, td2, td3, divtd8);

      container.append(tr);
    });
    i = 0;
  };
  let a = {};
  const updateDataForm = (el) => {
    let updateOfficer = document.querySelector(".updateOfficer");
    updateOfficer.classList.toggle("activeUpdateOfficer");
    // console.log(el)
    a = el;
    get("updateFname").value = el.fname;
    get("updateLname").value = el.lname;
    get("UpdateRanges").value = el.policerange;
    get("updateUsername").value = el.email;
    get("updateMobile").value = el.mobile;
    get("updateDistrict").value = el.districtofc;
    get("UpdateStation").value = el.policestation;
    get("updatePassword").value = "";
    get("updatePassword").placeholder = "Write New Password";
    return a;
  };
  let updateComp = document.querySelector(".closeIconUpdate");
  updateComp.onclick = function () {
    let compUpdate = document.querySelector(".updateOfficer");
    compUpdate.classList.toggle("activeUpdateOfficer");
  };
  const updateComplain = async () => {
    let obj = {
      fname: get("updateFname").value,
      lname: get("updateLname").value,
      mobile: get("updateMobile").value,
      alternatemobile: "",
      policerange: get("UpdateRanges").value,
      districtofc: get("updateDistrict").value,
      spname: "",
      designation: "IO",
      policestation: get("UpdateStation").value,
      email: get("updateUsername").value,
      password: get("updatePassword").value,
    };
    obj = JSON.stringify(obj);
    console.log(`https://hrycms.onrender.com/user/update/${a._id}`);
    let res = await fetch(`https://hrycms.onrender.com/user/update/${a._id}`, {
      method: "PUT",
      body: obj,
      headers: {
        "Content-type": "application/json",
      },
    });
    res = await res.json();
    alert("Update");
    let compUpdate = document.querySelector(".updateOfficer");
    compUpdate.classList.toggle("activeUpdateOfficer");
    getData();
  };

  // View
  const viewOfficer = (el) => {
    // console.log(el);
    let viewOfficer = document.querySelector(".viewOfficer");
    viewOfficer.classList.toggle("activeviewOfficer");
    a = el;
    get("viewFname").value = el.fname;
    get("viewLname").value = el.lname;
    get("viewRanges").value = el.policerange;
    get("viewUsername").value = el.email;
    get("viewMobile").value = el.mobile;
    get("viewDistrict").value = el.districtofc;
    get("viewPassword").value = "";
    get("viewStation").value = el.policestation;
    get("viewPassword").placeholder = "Write New Password";
    return a;
  };
  let viewComp = document.querySelector(".closeIconview");
  viewComp.onclick = function () {
    let compview = document.querySelector(".viewOfficer");
    compview.classList.toggle("activeviewOfficer");
  };
  // Delete
  const deleteIO = async (el) => {
    a = el;
    // console.log(a);
    let url = `https://hrycms.onrender.com/user/delete/${a._id}`;
    let res = await fetch(url, {
      method: "DELETE",
    });
    res = await res.json();
    // console.log(res);
    getData();
  };
  getData();
</script>
<script src="./common.js" type="module"></script>
